{% extends "layout.html" %}

{% block title %}
Admin
{% endblock %}
{% block main %}
<container class="text-monospace">

    <div class="row" id="top">
        <div class="col">
            <h1>Admin</h1>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <ul class="list-inline">
                <li class="list-inline-item">
                    <a href='/admin#events'>Events</a>
                </li>
                <li class="list-inline-item">
                    <a href='/admin#sku'>SKU</a>                   
                </li>
                <li class="list-inline-item">
                    <a href='/admin#database'>Database</a> 
                </li>
            </ul>
            <hr>
        </div>
    </div>

    <br>

    <div class="row">
        <div class="col">
            <h2 id='events'>Manage Events</h2>        
            <p>
                <a href='/admin#top'>return to top</a>
            </p>
        </div>
    </div>

    <div class="row"> 
        <div class="col-lg-3 col-md-6 col-sm-12">
            <h5>Create New</h5>
            <div class="form-group">
                <form action="/admin/new-event" method="post">            
                    <!-- Name -->
                    <div class="form-group">
                        <!-- <label for="name"></label> -->
                        <input type="text" placeholder="Event Name" class="form-control" name="name" id="name">            
                        <!-- <small id="" class="form-text text-muted">
                            Creates a new empty event.
                        </small> -->                    
                    </div>
                    <button type="submit" class="btn btn-primary btn-sm">Make Event</button>
                    <br>
                    <br>
                </div>
            </form>
        </div>
        
        <div class="col-lg-3 col-md-6 col-sm-12">
            <div>
                <h5>Import Projections<h5>
            </div>
            <form method="POST" action="/admin/import-event" enctype="multipart/form-data">
                
                <div class="form-group">
                    <!-- <label for="event"></label> -->
                    <select class="form-control" name="event" id="event">
                        <option title="Overrides all event data with import file">Select Event</option>
                        {% for cycle in cycles %}
                        <option title="Created on: {{ cycle.created_on }}" value="{{ cycle.id }}">{{ cycle.name }}</option>
                        {% endfor %}    
                    </select>
                </div>    
                
                <div class="form-group">
                    <input class="form-control" type="file" name="inputfile" id="inputfile" accept=".csv">
                </div>
                
                <!-- TODO why isn't this text smaller? -->
                <small class="form-text text-muted">
                    Adds Square sales export to Event's projections (in development)
                </small>
                <br>
                
                <button type="submit" class="btn btn-primary btn-sm" onclick="return confirm('Add projections to event?')">Import File</button>
                <br>
                
            </form>
        </div>

        <div class="col-lg-3 col-md-6 col-sm-12">
            <h5>Backup Projections</h5>
            <form action="/admin/backup-projections" method="post">
                <div class="form-group">
                    <!-- <label for="backup-projections"></label> -->
                    <select class="form-control" name="backup-projections" id="backup-projections">
                        {% for cycle in cycles %}
                            <option title="Created on: {{ cycle.created_on }}" value="{{ cycle.id }}">{{ cycle.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <small class="form-text text-muted">
                    Download .csv of current event projections. (in development)
                </small>
                <br>

                <button type="submit" title="" class="btn btn-primary btn-sm">Download</button>

            </form>
            <br>
        </div>
        
        <div class="col-lg-3 col-md-6 col-sm-12">
            <h5>Delete Event</h5>
            <form action="/admin/delete-event" method="post">
                <!-- Name -->
                <div class="form-group">
                    <!-- <label for="delname"></label> -->
                    <select class="form-control" name="delname" id="delname">
                        {% for cycle in cycles %}
                        <option title="Created on: {{ cycle.created_on }}">{{ cycle.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Delete event and all contents?')">Delete</button>
            </form>
            <br>
        </div>
    </div>
        
    <hr>

    <br>
    
    
    <div class="row">
        <div class="col">
            <h2 id='sku'>SKUs</h2>        
            <p>
                <a href='/admin#top'>return to top</a>
            </p>
        </div>
    </div>
    
    <div class="row">        
        <div class="col-lg-4 col-md-6 col-sm-12">
            <h5>Test SKU parser</h5>
            <form action="/admin/parse-sku" method="post">
                <input class="form-control" type="number" value="000000000000" id="sku" name="sku" autocomplete="on">
                <!-- <label for="sku">Parse number into SKU object</label> -->
                <div class="form-group">
                    <small>returns parsed object from SKU string</small>
                </div>
                <button type="submit" class="btn btn-primary btn-sm">Test</button>
            </form>
        </div>
        
        <div class="col-lg-8 col-md-6 col-sm-12">
            <h5>SKU instructions</h5>
            <p>12 digit SKU comprised of 6 pairs</p>
            <ul>
                <li>
                    XX __ __ __ __ __ = item
                </li>
                <li>
                    __ XX XX XX __ __ = colors
                </li>
                <li>
                    __ __ __ __ XX __ = unused (default to 0)
                </li>
                <li>
                    __ __ __ __ __ XX = size
                </li>
            </ul>
        </div>
    </div>
    
    <br>
    
    <div class="row justify-content-around">
        <div class="col-lg-4 col-md-6 col-sm-12">
            <h5>Make SKU</h5>
            
            <form class="form-group" action="/admin/make-sku" method="post">
                
                <div class="form-row">
                    <label class="col-4" for="nombre">Nombre</label>
                    <select class="col-8 form-control" name="nombre" id="nombre">
                        <!-- <option title="">Select Event</option> -->
                        {% for loteria in loterias %}
                        <option title="" value="{{ loteria.sku }}">{{ loteria.nombre }}</option>
                        {% endfor %}    
                    </select>
                </div>    

                <br>

                <div class="form-row">
                    <label class="col-4" for="a">Color A</label>
                    <select class="col-8 form-control" name="a" id="a">
                        <option selected title="Defaults to 00" value="00">none</option>
                        {% for color in colors %}
                            <option title="" value="{{ color.sku }}">{{ color.emoji }} {{ color.name }}</option>
                        {% endfor %}    
                    </select>
                </div>    
                
                <br>

                <div class="form-row">
                    <label class="col-4" for="b">Color B</label>
                    <select class="col-8 form-control" name="b" id="b">
                        <option selected title="Defaults to 00" value="00">none</option>
                        {% for color in colors %}
                            <option title="" value="{{ color.sku }}">{{ color.emoji }} {{ color.name }}</option>
                        {% endfor %}    
                    </select>
                </div>    

                <br>

                <div class="form-row">
                    <label class="col-4" for="c">Color C</label>
                    <select class="col-8 form-control" name="c" id="c">
                        <option selected title="Defaults to 00" value="00">none</option>
                        {% for color in colors %}
                            <option title="" value="{{ color.sku }}">{{ color.emoji }} {{ color.name }}</option>
                        {% endfor %}    
                    </select>
                </div>    

                <br>

                <!-- <div class="form-row">
                    <label class="col-4" for="d">Color D</label>
                    <select class="col-8 form-control" name="d" id="d">
                        <option selected title="Defaults to 00" value="00">none</option>
                        {% for color in colors %}
                            <option title="" value="{{ color.sku }}">{{ color.emoji }} {{ color.name }}</option>
                        {% endfor %}    
                    </select>
                </div>     -->

                <!-- <br> -->

                <div class="form-row">
                    <label class="col-4" for="size">Size</label>
                    <select class="col-8 form-control" name="size" id="size">
                        {% for size in sizes %}
                        <option title="" value="{{ size.sku }}">{{ size.longname }}</option>
                        {% endfor %}    
                    </select>
                </div>

                <br>

                <button type="submit" class="btn btn-primary btn-sm btn-block">Generate SKU</button>

            </form>
        </div>

        <div class="col-lg-8 col-md-6 col-sm-12">
            <h5>SKU example</h5>
            <img class="img-fluid text-center" alt="SKU setup explained"  src="/static/skuexample.png">
        </div>

    </div>

    <hr>
    <br>

    <div class="row">
        <div class="col">
            <h2 id='database'>
                Database
            </h2>
            <p>
                <a href='/admin#top'>return to top</a>
            </p>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6 col-sm-12">
            <form action="/admin/wipe" method="post">
                <h5>
                    Wipe Inventory
                </h5>
                <div class="form-group form-check">
                    <input type="checkbox" class="form-check-input" name="wipe-items" id="wipe-items" value="true">
                    <label class="form-check-label" for="wipe-items">Items</label>
                </div>
                
                <div class="form-group form-check">
                    <input type="checkbox" class="form-check-input" name="wipe-parts" id="wipe-parts" value="true">
                    <label class="form-check-label" for="wipe-parts">Parts</label>
                </div>
                
                <div class="form-group form-check">
                    <input type="checkbox" class="form-check-input" name="wipe-boxes" id="wipe-boxes" value="true">
                    <label class="form-check-label" for="wipe-boxes">Boxes</label>
                </div>
                
                <div class="form-group form-check">
                    <input type="checkbox" class="form-check-input" name="wipe-usedboxes" id="wipe-usedboxes" value="true">
                    <label class="form-check-label" for="wipe-usedboxes">Used Boxes</label>
                </div>

                <div class="form-group form-check">
                    <input type="checkbox" class="form-check-input" name="wipe-projections" id="wipe-projections" value="true">
                    <label class="form-check-label" for="wipe-projections">Projections <small>(current event)</small></label>
                </div>
                
                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure?')">Wipe</button>
            </form>
            <br>
        </div>
        
        <div class="col-md-6 col-sm-12">
            <h5>
                Loterias Template
            </h5>
            
            <form method="POST" action="/admin/setup-loterias" enctype="multipart/form-data">
                
                <div class="form-group">
                    <input class="form-control" type="file" name="inputfile" id="inputfile" accept=".csv">
                    <small class="form-text text-muted">
                        Upload new loterias template. Do not modify without database edits; only add new items.
                    </small>
                </div>
                
                
                <button type="submit" class="btn btn-primary btn-sm" onclick="return confirm('Update loterias db table with this file?')">Upload New</button>
                
            </form>
            <br>
            
            <form action="/downloads" method="post">
                <button name="file" value="loterias.csv" type="submit" class="btn btn-primary btn-sm">Download Current</button>
                <small class="form-text text-muted">
                    Download active template for reference or additions.
                </small>
            </form>
            <br>
        </div>
    </div>


    <hr>
    <br>
 
    <div class="row">
        <div class="col">
            <a href="/admin/convert"><button class="btn btn-primary">convert hearts</button></a>
            <small>testing, Mark don't touch</small>
        </div>
    </div>


    <!-- 
    <div class="row">
        <div class="col">
            <a href="/admin/setup-tables"><button class="btn btn-primary">Setup Tables ☢</button></a>
        </div>
    </div> -->

</container>

<!-- TODO relocate this script -->
<script>

    function copy() {
        var copyText = document.querySelector("#sku");
        copyText.select();
        document.execCommand("copy");
        // alert("SKU copied to clipboard: " + copyText.value);
        }

    document.querySelector("#copy").addEventListener("click", copy);

</script>                        

{% endblock %}
